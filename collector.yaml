extensions:
  health_check:
  zpages:
    endpoint: 0.0.0.0:55679

receivers:

  jaeger:
    protocols:
      grpc:
        endpoint: "0.0.0.0:14250"

  otlp:
    endpoint: "0.0.0.0:55680"

  prometheus:
    config:
      scrape_configs:
      - job_name: 'otel-collector'
        scrape_interval: 10s
        static_configs:
          - targets: ['localhost:8888']
            # Used to query metrics
            labels:
              environment: test
        metric_relabel_configs:
          - source_labels: [ __name__ ]
            regex: '.*grpc_io.*'
            action: drop

processors:

  batch:

  attributes/copyfromexistingkey:
    actions:
    - key: environment
      from_attribute: env
      action: upsert
  attributes/newenvironment:
    actions:
    - key: environment
      value: "test"
      action: insert

  queued_retry:

exporters:

  logging:

  zipkin:
    url: "http://tracing-server:9411/api/v2/spans"

service:

  pipelines:

    traces:
      receivers: [jaeger, otlp]
      processors: [batch, attributes/copyfromexistingkey, attributes/newenvironment, queued_retry]
      exporters: [logging, zipkin]

    #metrics:
    #  receivers: [prometheus]
    #  exporters: [logging]

  extensions: [health_check, zpages]
